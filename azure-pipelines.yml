trigger:
- master

jobs:
- job: setup_env
  displayName: 'Setup Environment'
  strategy:
    matrix:
      Server2019:
        AGENT_NAME: 'AZ-SERVER2019'
      Server2016:
        AGENT_NAME: 'AZ-SERVER2016'
      Windows10:
        AGENT_NAME: 'AZ-WIN10'
      Server2012R2:
        AGENT_NAME: 'AZ-WIN2012R2'
      Windows81:
        AGENT_NAME: 'AZ-WIN81'
  
  pool:
    name: windows-vms
  
  steps:
  - script: |
      choco install python -y --version 3.7.6
      SET PATH=/c/Python37:/c/Python37/Scripts:$PATH
      refreshenv
      python -m pip install --upgrade pip
      pip install -r requirements-test.txt
    displayName: 'Install dependencies'

  - script: |
      pip install -U pytest pytest-azurepipelines
      pytest -v
    displayName: 'Run Tests'